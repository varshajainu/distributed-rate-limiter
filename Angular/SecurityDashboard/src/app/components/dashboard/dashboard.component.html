<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="display-5 font-weight-bold text-primary mb-0">Security Monitor</h1>
      <p class="text-muted">Last updated: {{ lastUpdated | date:'mediumTime' }} 
        <span class="badge badge-pill badge-success ml-2">‚óè System Live</span>
      </p>
    </div>
    <div class="btn-group">
      <button class="btn btn-outline-danger me-2" (click)="resetStats()">
        <i class="fas fa-trash"></i> Reset Redis
      </button>
      <button class="btn btn-primary" (click)="downloadReport()">
        <i class="fas fa-file-pdf"></i> Download Report
      </button>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white">
          <h5 class="mb-0">Traffic Visualization</h5>
        </div>
        <div class="card-body">
          <div style="display: block; width: 100%; height: 350px;">
            <canvas id="canvas">{{ chart }}</canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-4 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white">
          <h5 class="mb-0">Active Sessions</h5>
        </div>
        <div class="card-body p-0" style="max-height: 400px; overflow-y: auto;">
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between align-items-center" 
                *ngFor="let ip of chart?.data?.labels; let i = index">
              <code>{{ ip }}</code>
              <span class="badge bg-primary rounded-pill">
                {{ chart?.data?.datasets[0]?.data[i] }} req/min
              </span>
            </li>
            <li class="list-group-item text-center text-muted" *ngIf="!chart?.data?.labels?.length">
              No active sessions.
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm mt-2">
    <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Security Watchlist / Blocklist</h5>
      <small>Automatic Blocking Threshold: 10 requests/min</small>
    </div>
    <div class="card-body">
      <table class="table table-hover mb-0">
        <thead class="thead-light">
          <tr>
            <th>IP Address</th>
            <th>Request Count (Current Window)</th>
            <th>Threat Status</th>
            <th>Action Taken</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ip of chart?.data?.labels; let i = index">
            <td><code>{{ ip }}</code></td>
            <td><strong>{{ chart?.data?.datasets[0]?.data[i] }}</strong></td>
            <td>
              <span *ngIf="chart?.data?.datasets[0]?.data[i] > 10" class="text-danger font-weight-bold">High Risk</span>
              <span *ngIf="chart?.data?.datasets[0]?.data[i] <= 10" class="text-success">Normal</span>
            </td>
            <td>
              <span *ngIf="chart?.data?.datasets[0]?.data[i] > 10" class="badge bg-danger">Traffic Blocked</span>
              <span *ngIf="chart?.data?.datasets[0]?.data[i] <= 10" class="badge bg-success">Allowed</span>
            </td>
          </tr>
          <tr *ngIf="!chart?.data?.labels?.length">
            <td colspan="4" class="text-center text-muted py-4">No suspicious traffic detected in the current window.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>